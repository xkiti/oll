# 背景：
智能时代下如何搭建安全稳定的Android客户端框架

# 一、智能家居App架构基本模块
智能家居App面向的对象除了自有服务器，用户，还需要面向物联网服务器以及设备。物联模块对于智能家居App来说是必不可少的模块。模块职责主要有以下几个方面：
1. 提供稳定、高效设备配网能力；
2. 提供app控制设备、实时接收设备属性变化；
3. 安全能力；

### 物联网平台消息通信流程
![Image]()
#### 上行数据链路
* 设备通过MQTT协议与物联网平台建立长连接，上报数据（通过Publish发布Topic和Payload）到物联网平台。
* 可配置规则引擎，编写SQL对上报数据进行处理，并配置转发规则，将处理后的数据转发到RDS、表格存储、函数计算、TSDB、企业版实例内的时序数据存储、DataHub、消息队列RocketMQ等云产品中，或通过AMQP消费组流转到您的ECS服务器上。
#### 下行指令链路
* ECS业务服务器调用基于HTTPS协议的API接口Pub，给Topic发送指令，将数据发送到物联网平台。
* 物联网平台通过MQTT协议，使用Publish发送数据（指定Topic和Payload）到设备端。

### 设备配网方式
设备配网指的是将路由器的Wi-Fi SSID和PASSWORD通过某种方式传递到终端设备，让终端设备可以接入Wi-Fi网络的过程。
对于无屏设备采用一建配网的方案，只需用户在App上输入Wi-Fi的密码即可。配网流程如下：
![Image]()
1. 手机通过广播发送Wi-Fi热点的SSID/密码信息。
2. 设备通过监听方式获取，并连接上网。

### 安全能力
#### 物联网平台提供多重防护，有效保障设备和云端数据的安全。
* ### 身份认证
1. 提供芯片级安全存储方案（ID²）及设备密钥安全管理机制，防止设备密钥被破解。安全级别很高。
2. 提供一机一密的设备认证机制，降低设备被攻破的安全风险。适合有能力批量预分配设备证书（ProductKey、DeviceName和DeviceSecret），将设备证书信息烧录到每个设备的芯片。安全级别高。
3. 提供一型一密的设备认证机制。设备预烧产品证书（ProductKey和ProductSecret），认证时动态获取设备证书（包括ProductKey、DeviceName和DeviceSecret）。适合批量生产时无法将设备证书烧录每个设备的情况。安全级别普通。
4. 提供X.509证书的设备认证机制，支持基于MQTT协议直连的设备使用X.509证书进行认证。安全级别很高。
* ### 通信安全
1. 支持TLS（MQTT、HTTPS）、DTLS（CoAP）数据传输通道，保证数据的机密性和完整性，适用于硬件资源充足、对功耗不是很敏感的设备。安全级别高。
2. 支持设备权限管理机制，保障设备与云端安全通信。
3. 支持设备级别的通信资源（Topic等）隔离，防止设备越权等问题。  
#### 物联模块提供也提供了身份认证和通信安全。
* ### 身份认证
1. Apk认证，通过App ID向物联网平台注册得到秘钥和签名。保证唯一App使用权。
2. 自有账号体系对接基于auth 2.0 API协议。使用自己的账号体系和物联平台关联，实现设备绑定关系、设备分享、设备消息推送等功能。自有账户体系中的用户信息不会保留在物联平台上，保障用户隐私信息。
* ### 通信安全
1. 实现TLS（MQTT、HTTPS）数据传输。

# 二、智家Android客户端演进之路

​		1.0版本 项目紧张，为满足快速上线，满足基本需求。

​		2.0版本 业务的发展，模块的增多，webview优化，启动速度达到性能瓶颈，多进程设计。

​		3.0版本 开放所有类型设备的接入，设备显示和设备控制页面需要动态下发。

# 三、基础模块的搭建思路

​        mvc、mvp、mvvm的优缺点，本app最终的选择，选择的依据

​        网络库本app最终的选择，选择的依据

​        图片库本app最终的选择，选择的依据

​        日志库本app最终的选择，选择的依据
